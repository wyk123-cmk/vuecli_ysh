<style scoped>
	.ljzxwk {
		bottom: 0px;
		width: 100%;
		max-width: 768px;
		padding-top: 74px;
		overflow: hidden;
		display: block;
		padding-bottom: 22px;

	}

	.bacco {}

	.grqyanwk {
		background-color: #FFFFFF;
		overflow: hidden;
		height: 31px;
		display: flex;
		justify-content: space-around;
		position: fixed;
		width: 100%;
		max-width: 768px;
		margin-top: 42px;
		z-index: 100;
	}

	.grqyanwk a {
		width: 10%;
		line-height: 26px;
		font-size: 13px;
		float: left;
		display: block;
		text-align: center;
	}

	.actives {
		border-bottom: 2px solid #FF1D21;
		font-size: 13px;
		color: #FF0004;
		padding-bottom: 9px;

	}

	.hsbj {
		background-image: -webkit-linear-gradient(0deg, rgba(255, 119, 66, 1.00) 0%, rgba(255, 69, 68, 1.00) 100%);
		background-image: -moz-linear-gradient(0deg, rgba(255, 119, 66, 1.00) 0%, rgba(255, 69, 68, 1.00) 100%);
		background-image: -o-linear-gradient(0deg, rgba(255, 119, 66, 1.00) 0%, rgba(255, 69, 68, 1.00) 100%);
		border-radius: 6px;
		background-image: linear-gradient(90deg, rgba(255, 119, 66, 1.00) 0%, rgba(255, 69, 68, 1.00) 100%);
		height: 90px;
		margin-left: 14px;
		margin-right: 14px;
		display: block;
		position: relative;
		margin-top: 12px;
	}

	.huisbj {
		border-radius: 6px;
		height: 90px;
		margin-left: 14px;
		margin-right: 14px;
		display: block;
		position: relative;
		margin-top: 12px;
		background-color: #999999;
	}

	.qianshu {
		float: left;
		font-size: 13px;
		color: #FFFFFF;
		width: 22%;
		text-align: center;
		padding-top: 18px;
	}

	.qianshu s {
		color: #FFFFFF;
		font-size: 28px;
	}

	.jeishao {
		color: #FFFFFF;
		font-size: 13px;
		float: left;
		padding-top: 26px;
		line-height: 22px;
	}

	.jeishao-sh {
		color: #FFFFFF;
		font-size: 13px;
		float: left;
		padding-top: 12px;
		line-height: 22px;
	}

	.biaoji-ljlp {
		float: right;
		color: #FF4944;
		background-color: #FFFFFF;
		margin-top: 34px;
		margin-right: 10px;
		padding-top: 4px;
		padding-bottom: 4px;
		padding-left: 10px;
		padding-right: 10px;
		border-radius: 16px;
		display: block;
		position: absolute;
		right: 0px;
	}

	.biaoji-ljlp-hs {
		float: right;
		color: #999999;
		background-color: #FFFFFF;
		margin-top: 34px;
		margin-right: 10px;
		padding-top: 4px;
		padding-bottom: 4px;
		padding-left: 10px;
		padding-right: 10px;
		border-radius: 16px;
		display: block;

	}

	.notkl {
		float: right;
		margin-top: 34px;
		margin-right: 10px;
		padding-top: 4px;
		padding-bottom: 4px;
		padding-left: 10px;
		padding-right: 10px;
		border-radius: 16px;
		display: block;
		color: #666666;
		background-color: #fff;
		position: absolute;
		right: 0px;
	}

	.biaoji-yl {
		float: right;
		color: #FF4944;
		margin-top: 47px;
		border-radius: 16px;
		display: block;
		background-image: url(../../assets/images/yl.svg);
		width: 42px;
		height: 42px;
		background-size: 50px 50px;
		background-repeat: no-repeat;
	}



	.jeishao-sh s {
		font-size: 14px;
		color: #FFFFFF;
	}

	.hsbj1 {
		background-image: -webkit-linear-gradient(0deg, rgba(255, 119, 66, 1.00) 0%, rgba(255, 69, 68, 1.00) 100%);
		background-image: -moz-linear-gradient(0deg, rgba(255, 119, 66, 1.00) 0%, rgba(255, 69, 68, 1.00) 100%);
		background-image: -o-linear-gradient(0deg, rgba(255, 119, 66, 1.00) 0%, rgba(255, 69, 68, 1.00) 100%);
		border-radius: 6px;
		background-image: linear-gradient(90deg, rgba(255, 119, 66, 1.00) 0%, rgba(255, 69, 68, 1.00) 100%);
		height: 90px;
		margin-left: 14px;
		margin-right: 14px;
		display: block;
		position: static;
		margin-top: 12px;
	}

	.hsbj2 {
		background-image: -webkit-linear-gradient(0deg, rgba(255, 119, 66, 1.00) 0%, rgba(255, 69, 68, 1.00) 100%);
		background-image: -moz-linear-gradient(0deg, rgba(255, 119, 66, 1.00) 0%, rgba(255, 69, 68, 1.00) 100%);
		background-image: -o-linear-gradient(0deg, rgba(255, 119, 66, 1.00) 0%, rgba(255, 69, 68, 1.00) 100%);
		border-radius: 6px;
		background-image: linear-gradient(90deg, rgba(255, 119, 66, 1.00) 0%, rgba(255, 69, 68, 1.00) 100%);
		height: 90px;
		margin-left: 14px;
		margin-right: 14px;
		display: block;
		position: static;
		margin-top: 12px;
	}

	.hxx {
		border-bottom: 1px solid #FF1D21;
	}

	.yhjdb {
		background-color: #FFFFFF;
		position: fixed;
		bottom: 0px;
		width: 100%;
		max-width: 768px;
		text-align: center;
		font-size: 14px;
		padding-top: 16px;
		padding-bottom: 16px;
	}

	.grqyanwk1 {
		background-color: #FFFFFF;
		overflow: hidden;
		height: 31px;
		display: flex;
		justify-content: space-around;
		position: fixed;
		width: 100%;
		max-width: 768px;
		margin-top: 42px;
	}
</style>
<template>
	<div>
		<header>
			<a class="iconfont icon-back" @click="btnnav"><br></a>
			<h1 class="tab-title">优惠券</h1>
			<span class="menu" @click="yhqInfo()">说明</span>
		</header>
		<p class="grqyanwk">
			<a :class="navIndex==i?'actives':''" v-for="(item, i) in tabNav" :key="i" @click="navIndexTap(i)">{{item}}</a>
		</p>
		<ul class="ljzxwk">
			<li :class="item.isget=='1'&&item.status=='2'?'huisbj':'hsbj'" v-for="(item,i) in CouponList" :key="i">
				<span class="qianshu">￥<s>{{item.amount}}</s><br>优惠券</span>
				<span class="jeishao-sh"><s v-if="item.status=='2' || item.status=='3'">{{item.orderNumDetail}}</s><br><s style="font-size:13px;">{{item.fullReducAmount}}</s><br>{{item.validity}}</span>
				<span v-if="(item.status=='2' && item.isget.indexOf('_')<0)|| ( item.isget=='0'&& item.status=='3') || (item.isget=='0'&& item.status=='1')"
				 :class="item.isget=='0'&& item.status=='2'?'biaoji-ljlp-hs':'notkl'" @click="PostCoupon(item.id,item.isget)" ref="btnlq">立即领取</span>

				<span class="biaoji-ljlp" v-if="item.status=='3'&& item.isget=='1'" @click="sharePost(item.id,item.amount)" v-model="copycont">分享助力</span>
				<span class="biaoji-yl" v-if="item.isget.indexOf('_')>-1"></span>
			</li>
		</ul>
		<div class="yhjdb" @click="LookYhq()"><span class="iconfont yjt">{{yhqName}}优惠券</span></div>
		<mt-popup v-model="showSend" position="top" class="my-popup sentpopup" @touchmove.native.stop.prevent style="width:100%;background: none;">
			<div @click="showSend=false" class="bacco">
				<img src="../../assets/images/share-picjt.svg" alt="请点击右上角的分享按钮分享" />
			</div>
		</mt-popup>
		<div class="noneData" v-show="noneData">
			<img src="../../assets/images/none-fp.svg" />
			<span>暂无内容</span>
		</div>

	</div>
</template>

<script>
	import {
		Indicator
	} from "mint-ui";
	import {
		GetList,
		PostVoucherCoupon,
		PostCreateAssistInfo,
		GetCouponWechatUrl
	} from '../../api/api.js'
	export default {
		data() {
			return {
				islogin: this.$Context.isLogin(),
				tabNav: ['个人', '企业'],
				yhqName: "我的",
				navIndex: 0,
				CouponList: [],
				ComCouponList: [],
				usetype: "",
				noneData: false,
				showSend: false,
				url: "",
				copycont: "fenxiang"

			}
		},
		mounted() {
			this.redirect = this.$route.query.redirect;
		},
		created() {
			if (this.$route.query.ismaster !== "" || this.$route.query.ismaster !== undefined) {
				if (this.$route.query.ismaster == true) {
					console.log("890");
					this.navIndex = "1";
					this.usetype = "comp";

				}
			}

			if (this.navIndex == "0") {
				this.usetype = "indi"
			}

			var parm = {
				userType: this.usetype
			}
			GetList(parm).then(data => {
				if (this.$route.query.ismaster == true) {
					this.yhqName = "企业";
				}
				console.log(data);
				console.log("090");
				this.CouponList = data.list;

			})

		},
		mounted() {
			if (this.$route.query.ismaster !== "" || this.$route.query.ismaster !== undefined) {
				if (this.$route.query.ismaster == true) {
					this.yhqName = "企业";
				}
			}
		},
		methods: {
			share() {
				this.$router.push({
					path: "/shareyhq",
					query: {
						redirect: "yhq"
					}
				});
			},
			LookYhq() {
				if (this.yhqName == "我的") {
					this.$router.push({
						path: "/myyhq",
						query: {
							redirect: "yhq",
							pageType: "indi"
						}
					});
				} else {
					this.$router.push({
						path: "/myyhq",
						query: {
							redirect: "yhq",
							pageType: "comp"
						}
					});
				}

			},
			//优惠券说明
			yhqInfo() {

				this.$router.push({
					path: "/yhqInfo",
					query: {
						redirect: "yhq"
					}
				})
			},
			navIndexTap(i) {
				if (i == "0") {
					this.navIndex = 0;
					this.usetype = "indi";
					this.yhqName = "我的";
				} else {
					this.navIndex = 1;
					this.usetype = "comp";
					this.yhqName = "企业";
				}
				var parm = {
					userType: this.usetype
				}
				GetList(parm).then(data => {
					console.log(data);
					if (data == "" || data == undefined) {
						this.CouponList = "";
						this.noneData = true;
					}
					this.CouponList = data.list;
				})
			},
			btnnav() {
				if (!this.$route.query.redirect) {
					this.$router.replace('/jkd');
				} else {
					this.$router.replace(this.$route.query.redirect);

				}
			},

			//认领优惠券
			PostCoupon(id, isget) {
				if (isget == "1") {
					this.$refs.btnlq.disabled = true;
					return false;

				}
				if (this.navIndex == "0") {
					this.usetype = "indi"
				} else {
					this.usetype = "comp"
				}
				var parme = {
					userType: this.usetype,
					couponId: id
				}
				PostVoucherCoupon(parme).then(data => {
					console.log(data);
					if (data !== "") {
						this.$toast({
							duration: 1000,
							message: "领取成功",
							position: "top"
						});
					}
					this.CouponList.forEach(item => {
						if (item.id == id) {
							item.isget = "_"
						}
					})
					this.navIndexTap(this.navIndex);
				})
			},
			onCopy() {
				this.$toast({
					duration: 1000,
					message: "链接已复制，赶快分享给好友吧！",
					position: "top"
				});
			},

			//分享助力优惠券
			sharePost(id, amount) {
				console.log(window.location.host);
				if (this.navIndex == "0") {
					this.usetype = "indi"
				} else {
					this.usetype = "comp"
				}
				var parme = {
					userType: this.usetype,
					couponId: id
				}
				PostCreateAssistInfo(parme).then(data => {
					console.log(data);

					var pare = {
						AssistId: data
					}

					GetCouponWechatUrl(pare).then(datas => {
						console.log(datas);
						console.log(window.location.host);
						var ine = "http://" + window.location.host + "/static/img/coupon" + amount + ".png";
						console.log(ine);
						this.url = datas;
						this.copycont = "http://" + window.location.host + "/shareyhq?id=" + id + "&red=yhq&img=" + this.url;
						if (this.$util.isWeiXin() == true) {
							this.showSend = true;
							console.log("weixin");
							this.$util.wxshare({
								title: "我在领" + amount + "元物流大额券点击助力一下呗",
								desc: '助力成功您将获得一份尊享礼包',
								link: "http://" + window.location.host + "/shareyhq?id=" + id + "&red=yhq&img=" + this.url,
								imgUrl: ine,
								jhType: 0,
								jhMode: 0,
								circleCode: "",
								postId: 0,
								cardcode: "",
								success: function() {
									this.$toast({
										duration: 1000,
										message: "已成功分享给好友",
										position: "top"
									});
								},
								cancel: function() {
									this.$toast({
										duration: 1000,
										message: "已取消分享",
										position: "top"
									});
								}
							});
						} else {

							this.showSend = false;
							this.$copyText(this.copycont).then(res => {
								this.onCopy()
							})
							console.log("notweixin");
						}

					})


				})
			}
		}
	}
</script>
