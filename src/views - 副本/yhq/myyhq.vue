<style scoped>
	.ljzxwk {
		bottom: 0px;
		width: 100%;
		max-width: 768px;
		padding-top: 74px;
		overflow: hidden;
		display: block;
		padding-bottom: 22px;

	}

	.grqyanwk {
		background-color: #FFFFFF;
		overflow: hidden;
		height: 31px;
		display: flex;
		justify-content: space-around;
		position: fixed;
		width: 100%;
		max-width: 768px;
		margin-top: 42px;
		z-index: 100;
	}

	.grqyanwk a {
		width: 18%;
		line-height: 26px;
		font-size: 13px;
		float: left;
		display: block;
		text-align: center;
	}

	.actives {
		border-bottom: 2px solid #FF1D21;
		font-size: 13px;
		color: #FF0004;
		padding-bottom: 9px;
	}

	.hsbj {
		background-image: -webkit-linear-gradient(0deg, rgba(255, 119, 66, 1.00) 0%, rgba(255, 69, 68, 1.00) 100%);
		background-image: -moz-linear-gradient(0deg, rgba(255, 119, 66, 1.00) 0%, rgba(255, 69, 68, 1.00) 100%);
		background-image: -o-linear-gradient(0deg, rgba(255, 119, 66, 1.00) 0%, rgba(255, 69, 68, 1.00) 100%);
		border-radius: 6px;
		background-image: linear-gradient(90deg, rgba(255, 119, 66, 1.00) 0%, rgba(255, 69, 68, 1.00) 100%);
		height: 90px;
		margin-left: 14px;
		margin-right: 14px;
		display: block;
		position: relative;
		margin-top: 12px;
		z-index: 0;
	}

	.huisbj {
		border-radius: 6px;
		height: 90px;
		margin-left: 14px;
		margin-right: 14px;
		display: block;
		position: static;
		margin-top: 12px;
		background-color: #999999;
	}

	.qianshu {
		float: left;
		font-size: 13px;
		color: #FFFFFF;
		width: 80px;
		text-align: center;
		padding-top: 18px;
	}

	.qianshu s {
		color: #FFFFFF;
		font-size: 28px;
	}

	.jeishao {
		color: #FFFFFF;
		font-size: 13px;
		float: left;
		padding-top: 26px;
		line-height: 22px;
	}

	.jeishao-sh {
		color: #FFFFFF;
		font-size: 13px;
		float: left;
		padding-top: 12px;
		line-height: 19px;
	}

	.biaoji-ljlp {
		float: right;
		color: #FF4944;
		background-color: #FFFFFF;
		margin-top: 34px;
		margin-right: 10px;
		padding-top: 4px;
		padding-bottom: 4px;
		padding-left: 10px;
		padding-right: 10px;
		border-radius: 16px;
		display: block;
	}

	.biaoji-ljlp-hs {
		float: right;
		color: #999999;
		background-color: #FFFFFF;
		margin-top: 34px;
		margin-right: 10px;
		padding-top: 4px;
		padding-bottom: 4px;
		padding-left: 10px;
		padding-right: 10px;
		border-radius: 16px;
		display: block;
	}

	.biaoji-ljlp-jhs {
		float: right;
		color: #FFFFFF;
		display: block;
		background-image: url(../../assets/images/yiyong.png);
		width: 54px;
		background-repeat: no-repeat;
		padding-top: 53px;
		font-size: 15px;
		text-align: center;
		position: absolute;
		top: -1px;
		z-index: 100;
		right: 0px;
	}


	.biaoji-ljlp-whs {
		float: right;
		color: #FFFFFF;
		display: block;
		width: 54px;
		background-repeat: no-repeat;
		padding-top: 60px;
		font-size: 15px;
		text-align: center;
	}

	.biaoji-ljlp-hjy {
		float: right;
		color: #FFFFFF;
		display: block;
		background-image: url(../../assets/images/xhuise.png);
		width: 54px;
		background-repeat: no-repeat;
		padding-top: 57px;
		font-size: 15px;
		text-align: center;
		position: absolute;
		right: 0px;
	}

	.biaoji-yl {
		float: right;
		color: #FF4944;
		margin-top: 47px;
		border-radius: 16px;
		display: block;
		background-image: url(../../assets/images/yl.svg);
		width: 42px;
		height: 42px;
		background-size: 50px 50px;
		background-repeat: no-repeat;
	}



	.jeishao-sh s {
		font-size: 16px;
		color: #FFFFFF;
	}

	.hsbj1 {
		background-image: -webkit-linear-gradient(0deg, rgba(255, 119, 66, 1.00) 0%, rgba(255, 69, 68, 1.00) 100%);
		background-image: -moz-linear-gradient(0deg, rgba(255, 119, 66, 1.00) 0%, rgba(255, 69, 68, 1.00) 100%);
		background-image: -o-linear-gradient(0deg, rgba(255, 119, 66, 1.00) 0%, rgba(255, 69, 68, 1.00) 100%);
		border-radius: 6px;
		background-image: linear-gradient(90deg, rgba(255, 119, 66, 1.00) 0%, rgba(255, 69, 68, 1.00) 100%);
		height: 90px;
		margin-left: 14px;
		margin-right: 14px;
		display: block;
		position: static;
		margin-top: 12px;
	}

	.hsbj2 {
		background-image: -webkit-linear-gradient(0deg, rgba(255, 119, 66, 1.00) 0%, rgba(255, 69, 68, 1.00) 100%);
		background-image: -moz-linear-gradient(0deg, rgba(255, 119, 66, 1.00) 0%, rgba(255, 69, 68, 1.00) 100%);
		background-image: -o-linear-gradient(0deg, rgba(255, 119, 66, 1.00) 0%, rgba(255, 69, 68, 1.00) 100%);
		border-radius: 6px;
		background-image: linear-gradient(90deg, rgba(255, 119, 66, 1.00) 0%, rgba(255, 69, 68, 1.00) 100%);
		height: 90px;
		margin-left: 14px;
		margin-right: 14px;
		display: block;
		position: static;
		margin-top: 12px;
	}

	.hxx {
		border-bottom: 1px solid #FF1D21;
	}

	.grqyanwk1 {
		background-color: #FFFFFF;
		overflow: hidden;
		height: 31px;
		display: flex;
		justify-content: space-around;
		position: fixed;
		width: 100%;
		max-width: 768px;
		margin-top: 42px;
	}

	.yhjdb {
		background-color: #FFFFFF;
		position: fixed;
		bottom: 0px;
		width: 100%;
		max-width: 768px;
		text-align: center;
		font-size: 14px;
		padding-top: 16px;
		padding-bottom: 16px;
		box-shadow: 0px -1px 5px 1px #DCDCDC;
		-webkit-box-shadow: 0px -1px 5px 1px #DCDCDC;
	}

	.yhjdb s {
		background-color: #FF6F42;
		color: #FFFFFF;
		padding-left: 6px;
		padding-right: 6px;
		padding-top: 3px;
		padding-bottom: 3px;
		border-radius: 26px;
		font-size: 14px;
		margin-left: 16px;
	}
</style>
<template>
	<div>
		<header>
			<a class="iconfont icon-back" @click="$router.replace('/me')"><br></a>
			<h1 class="tab-title">{{contents}}优惠券</h1>

		</header>
		<p class="grqyanwk">
			<a :class="navIndex==i?'actives':''" v-for="(item, i) in tabNav" :key="i" @click="GetPageUserListLimit(i)">{{item.title}}({{item.count}})</a>
		</p>
		<ul class="ljzxwk">

			<li class="hsbj" v-for="(item,i) in listData" :key="i">
				<span class="qianshu">￥<s>{{item.amount}}</s><br>优惠券</span>
				<span class="jeishao-sh"><s v-if="item.status=='2' || item.status=='3'">{{item.orderNumDetail}}</s><br><s
					 style="font-size:14px;">{{item.fullReducAmount}}</s><br>{{item.overdate}}</span>
				<span class="biaoji-ljlp-jhs" v-if="item.claimType =='1'"></span>
				<span class="biaoji-ljlp-hjy" v-if="item.claimType=='2'"></span>
			</li>
		</ul>
		<div class="noneData" v-show="noneData">
			<img src="../../assets/images/none-fp.svg" />
			<span>暂无内容</span>
		</div>
		<div class="yhjdb" @click="btnMore()">去领券中心<s>领更多优惠券</s></div>
	</div>

</template>

<script>
	import {
		GetPageUserList,
		PostVoucherCoupon,
		PostCreateAssistInfo,
		GetCouponWechatUrl
	} from '../../api/api.js'
	export default {
		data() {
			return {
				tabNav: [{
					title: '可用券',
					count: '0'
				}, {
					title: '已用券',
					count: '0'
				}, {
					title: '失效券',
					count: '0'
				}],
				navIndex: 0,
				redirect: "",
				limit: "10",
				page: "1",
				userType: "indi",
				status: "0",
				listData: [],
				total: "",
				contents: "我的",
				noneData: false

			}
		},
		created() {
			this.contents = this.$route.query.pageType == 'indi' ? '我的' : '企业';
			if (this.$route.query.pageType) {
				this.userType = this.$route.query.pageType;
			}
			this.GetCount(0);
			this.GetCount(1);
			this.GetCount(2);
			this.GetPageUserListLimit(0);
		},

		mounted() {
			console.log(this.redirect);
			this.redirect = this.$route.query.redirect;
			if (this.nav == true) {
				this.redirect = "/me"
			}
		},
		methods: {
			btnMore() {
			
				this.$router.push({
					path: "/yhq",
					query: {
						redirect: this.$route.fullPath
					}
				});
				this.nav = true;
			},
			GetPageUserListLimit(i) {

				if (i == 0) {
					this.navIndex = 0;
				}
				if (i == 1) {
					this.navIndex = 1;
				}
				if (i == 2) {
					this.navIndex = 2;
				}
				let _page = 1;
				let parme = {
					page: this.page,
					limit: this.limit,
					userType: this.userType,
					claimType: i
				}
				GetPageUserList(parme).then(data => {
					// this.tabNav.forEach((item, index) => {
					// 	if (i == index) {
					// 		item.count = data.total;
					// 	}
					// })
					if (data.total == 0) {
						//如果数据为空   去掉组件this.listData = data.list;
						this.listData = data.list;
						this.noneData = true;
						this.$Context.delScrollLoad();
						return false;
					}
					this.noneData = false;
					if (data.total < this.limit) {
						//如果数据小于等于limit 去掉组件
						this.listData = data.list;
						this.$Context.delScrollLoad();
						return false;
					}
					if (Math.ceil(data.total / this.limit) >= this.page) {
						console.log("556");

						this.listData = this.listData.concat(data.list);

						this.total = data.total;
						let that = this;
						this.$Context.loading = false;
						this.$Context.setScrollLoad($(".scroll"), function() {
							that.page++;
							that.GetPageUserListLimit(parme.claimType);
						});
					}

				});

			},
			GetCount(i) {
				let parme = {
					page: this.page,
					limit: this.limit,
					userType: this.userType,
					claimType: i
				}
				GetPageUserList(parme).then(data => {
					this.tabNav.forEach((item, index) => {
						if (i == index) {
							item.count = data.total;
						}
					})
				})
			}
		}
	}
</script>
